<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>اضافة كتاب جديد</title>
    <meta name="description" content="إضافة كتاب جديد إلى نظام المكتبة" />

    <!-- Bootstrap RTL CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
      rel="stylesheet"
    />

    <!-- Arabic Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        /* Background & Surface Colors */
        --background: hsl(218, 100%, 97%);
        --foreground: hsl(215, 25%, 15%);
        --surface: hsl(0, 0%, 100%);
        --surface-alt: hsl(220, 15%, 96%);

        /* Brand Colors */
        --primary: hsl(215, 90%, 52%);
        --primary-foreground: hsl(0, 0%, 100%);
        --primary-light: hsl(215, 85%, 65%);
        --primary-dark: hsl(215, 95%, 42%);

        /* Secondary Brand */
        --secondary: hsl(195, 85%, 48%);
        --secondary-foreground: hsl(0, 0%, 100%);
        --secondary-light: hsl(195, 80%, 65%);

        /* Accent Colors */
        --accent: hsl(275, 75%, 55%);
        --success: hsl(142, 76%, 45%);
        --warning: hsl(38, 92%, 55%);
        --destructive: hsl(0, 84%, 60%);

        /* Neutral Colors */
        --muted: hsl(220, 15%, 94%);
        --muted-foreground: hsl(215, 16%, 47%);
        --border: hsl(220, 13%, 88%);

        /* Shadows */
        --shadow-soft: 0 2px 8px -2px hsl(215, 25%, 15%, 0.08);
        --shadow-medium: 0 4px 16px -4px hsl(215, 25%, 15%, 0.12);
        --shadow-large: 0 8px 32px -8px hsl(215, 25%, 15%, 0.16);
        --shadow-glow: 0 0 32px hsl(215, 90%, 52%, 0.3);
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Cairo", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        line-height: 1.6;
      }

      /* Custom utility classes */
      .gradient-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
      }

      .gradient-secondary {
        background: linear-gradient(135deg, var(--accent), var(--primary));
      }

      .shadow-soft {
        box-shadow: var(--shadow-soft);
      }
      .shadow-medium {
        box-shadow: var(--shadow-medium);
      }
      .shadow-large {
        box-shadow: var(--shadow-large);
      }
      .shadow-glow {
        box-shadow: var(--shadow-glow);
      }

      .transition-smooth {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Navigation */
      .navbar {
        top: 10px;
        right: 10px;
        left: 10px;
        border-radius: 1rem;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-large);
      }

      .navbar-brand img {
        border-radius: 50%;
      }

      /* Container */
      .container {
        padding-top: 100px;
      }

      /* Cards */
      .card {
        background-color: var(--surface);
        border: 1px solid var(--border);
        border-radius: 1rem;
        box-shadow: var(--shadow-soft);
        transition: var(--transition-smooth);
      }

      .card:hover {
        box-shadow: var(--shadow-medium);
      }

      .card-header {
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        border-radius: 1rem 1rem 0 0;
        font-weight: 600;
      }

      /* Form Controls */
      .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.2rem rgba(var(--primary-rgb), 0.25);
      }

      .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.2rem rgba(var(--primary-rgb), 0.25);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border: none;
      }

      .btn-primary:hover {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary)
        );
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success), hsl(155, 70%, 55%));
        border: none;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      /* Progress Bar */
      .progress {
        height: 8px;
        border-radius: 1rem;
        background-color: var(--muted);
        overflow: hidden;
      }

      .progress-bar {
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        transition: width 0.4s ease;
      }

      /* Wizard Steps */
      .wizard-step {
        transition: opacity 0.3s ease;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .container {
          padding-top: 120px;
        }
        .navbar {
          position: relative;
          top: 0;
          margin: 10px;
        }
      }

      /* Print styles (for consistency) */
      @media print {
        body * {
          visibility: hidden;
        }
        #wizardForm,
        #wizardForm * {
          visibility: visible;
        }
        #wizardForm {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          padding: 20px;
        }
        .no-print {
          display: none !important;
        }
        .navbar {
          display: none !important;
        }
      }
    </style>
  </head>

  <body>
    <nav
    class="navbar navbar-expand-lg navbar-dark bg-dark py-3 px-4 rounded-3 shadow-lg"
  >
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img
          src="./slogan.png"
          alt="Logo"
          class="rounded-circle me-2"
          width="64px"
          height="64px"
        />
        إدارة الكتب 
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="collapse navbar-collapse justify-content-center"
        id="navbarNavDropdown"
      >
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="add-book.html">📚 إضافة كتاب جديد</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="update-books.html">📖 عرض وتحديث الكتب</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="advanced-search.html">🔍 بحث عن كتاب</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="reports.html"
              >📈 التقارير</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="delete-books.html"
              >🗑️ حذف كتاب</a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>

    <div class="container mt-4">
      <!-- Page Header -->
      <div class="mb-5">
        <h1
          class="display-5 fw-bold text-primary mb-2 d-flex align-items-center gap-3"
        >
          📚 إضافة كتاب جديد
        </h1>
        <p class="text-muted fs-5">أدخل بيانات الكتاب خطوة بخطوة</p>
      </div>

      <!-- Progress Tracker -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>الخطوة <span id="currentStepNumber">1</span> من 5</span>
            <span id="stepTitle" class="fw-bold">المعلومات الأساسية</span>
          </div>
          <div class="progress">
            <div
              class="progress-bar"
              role="progressbar"
              id="progressBar"
              style="width: 20%"
            ></div>
          </div>
        </div>
      </div>

      <form
        id="wizardForm"
        method="post"
        onsubmit="return handleFormSubmit(event)"
      >
        <!-- Step 1: Basic Info -->
        <div class="wizard-step" id="step1">
          <div class="card shadow-medium">
            <div class="card-header">
              <h5 class="mb-0">📌 الخطوة 1: المعلومات الأساسية</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">رقم التسلسل</label>
                  <input
                    type="text"
                    class="form-control"
                    id="classificationCode"
                    value="***"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label"
                    >رمز التصنيف <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="classificationCode"
                    value="***"
                    required
                  />
                </div>
                <div class="col-md-6">
                <label class="form-label">اللاحقة<span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="bookTitle" value="***" required />
              </div>
                <div class="col-md-12">
  <label class="form-label">
    عنوان الكتاب <span class="text-danger">*</span>
  </label>
  <input
    type="text"
    class="form-control"
    id="bookTitle"
    value="***"
    required
  />
</div>
                <div class="col-12">
                  <label class="form-label">عناوين فرعية</label>
                  <div id="subTitlesContainer">
                    <div class="input-group mb-2">
                      <input
                        type="text"
                        class="form-control"
                        name="subTitles[]"
                        placeholder="العنوان الفرعي"
                      />
                      <select class="form-select" name="subTitleType[]">
                        <option value="">نوع العنوان</option>
                        <option value="فرعي">فرعي</option>
                        <option value="بديل">بديل</option>
                        <option value="موازي">موازي</option>
                      </select>
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="addSubTitle()"
                      >
                        +
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <label class="form-label">الأبعاد</label>
                  <input
                    type="text"
                    class="form-control"
                    id="bookLength"
                    min="0"
                    placeholder="الطول x العرض"/>
                </div>
                <div class="col-md-4">
                  <label class="form-label">المستوى البليوغرافي</label>
                  <div class="input-group">
                    <select class="form-select" id="bibliographicLevel">
                      <option value="">اختر...</option>
                      <option value="كتاب">كتاب</option>
                      <option value="مرجع">مرجع</option>
                      <option value="مجموعة">مجموعة</option>
                      <option value="رسالة جامعية">رسالة جامعية</option>
                      <option value="كتب أطفال">كتب أطفال</option>
                      <option value="قصة">قصة</option>
                      <option value="دورية">دورية</option>
                      <option value="سمعيات-بصريات">سمعيات-بصريات</option>
                    </select>
                    <button
                      class="btn btn-outline-secondary"
                      type="button"
                      onclick="addOption('bibliographicLevel')"
                    >
                      +
                    </button>
                  </div>
                </div>
                <div class="col-md-12">
                <label class="form-label">رأس الموضوع</label>
                <textarea class="form-control" id="explanations" rows="3"></textarea>
              </div>
                <div class="col-md-6">
                  <label class="form-label">المستخلص</label>
                  <textarea
                    class="form-control"
                    id="bookAbstract"
                    rows="3"
                  ></textarea>
                </div>
                <div class="col-md-6">
                  <label class="form-label">الإيضاحات</label>
                  <textarea
                    class="form-control"
                    id="explanations"
                    rows="3"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Authors -->
        <div class="wizard-step" id="step2" style="display: none">
          <div class="card shadow-medium">
            <div class="card-header">
              <h5 class="mb-0">👤 الخطوة 2: المؤلفون</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label">نوع / دور المؤلف</label>
                  <div id="authorsContainer">
                    <div class="input-group mb-2">
                      <select class="form-select" name="authorRole[]">
                        <option value="">اختر...</option>
                        <option value="رئيسي">رئيسي</option>
                        <option value="مساعد مشارك">مساعد مشارك</option>
                        <option value="مترجم">مترجم</option>
                        <option value="محقق">محقق</option>
                        <option value="مدقق">مدقق</option>
                        <option value="مراجع">مراجع</option>
                        <option value="محرر">محرر</option>
                        <option value="معد">معد</option>
                        <option value="مقدّم">مقدّم</option>
                      </select>
                      <input
                        type="text"
                        class="form-control"
                        name="authorName[]"
                        placeholder="اسم المؤلف"
                      />
                      <select class="form-select" name="authorAttribute[]">
                        <option value="">صفة المؤلف</option>
                        <option value="شخص">شخص</option>
                        <option value="ملتقى">ملتقى</option>
                        <option value="هيئة">هيئة</option>
                        <option value="عنوان">عنوان</option>
                      </select>
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="addAuthor()"
                      >
                        +
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Publishers -->
        <div class="wizard-step" id="step3" style="display: none">
          <div class="card shadow-medium">
            <div class="card-header">
              <h5 class="mb-0">🏢 الخطوة 3: الناشرون</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label">اسم الناشر</label>
                  <div id="publishersContainer">
                    <div class="input-group mb-2">
                      <input
                        type="text"
                        class="form-control"
                        name="publishers[]"
                        placeholder="اسم الناشر"
                      />
                      <input
                        type="text"
                        class="form-control"
                        name="publisherPlace[]"
                        placeholder="مكان النشر"
                      />
                      <span class="input-group-text">تاريخ النشر</span>
                      <input
                        type="number"
                        class="form-control"
                        name="publisherDate[]"
                      />
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">الطبعة</label>
                  <input type="text" class="form-control" id="edition" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">رقم ISBN</label>
                  <input type="text" class="form-control" id="isbn" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">رقم الإيداع</label>
                  <input type="text" class="form-control" id="depositNumber" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">عدد الصفحات</label>
                  <input
                    type="number"
                    class="form-control"
                    id="pagesCount"
                    min="1"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">السلسلة</label>
                  <input type="text" class="form-control" id="series" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">الأجزاء</label>
                  <input
                    type="number"
                    class="form-control"
                    id="parts"
                    min="1"
                  />
                </div>
                <div class="col-md-6">
                <label class="form-label">السلسلة الفرعية</label>
                <input type="text" class="form-control" id="series" />
              </div>
              <div class="col-md-6">
                <label class="form-label">الأجزاء</label>
                <input type="number" class="form-control" id="parts" min="1" />
              </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 4: Supplier -->
        <div class="wizard-step" id="step4" style="display: none">
          <div class="card shadow-medium">
            <div class="card-header">
              <h5 class="mb-0">🚚 الخطوة 4: المزوّد</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">تاريخ التزويد</label>
                  <input type="date" class="form-control" id="supplyDate" />
                </div>
                <div class="col-md-6">
                  <label class="form-label">طريقة التزويد</label>
                  <select
                    id="supplyMethod"
                    class="form-select"
                    onchange="togglePriceField()"
                  >
                    <option value="">اختر...</option>
                    <option value="شراء">شراء</option>
                    <option value="إهداء">إهداء</option>
                    <option value="تبادل">تبادل</option>
                  </select>
                </div>
                <div class="col-md-6" id="priceField" style="display: none">
                <label class="form-label">السعر</label>
                <div class="input-group">
                  <input type="number" class="form-control" id="price" step="0.01" min="0" />
                  <select class="form-select" id="currency">
                    <option value="">اختر العملة</option>
                    <option value="شيكل">شيقل</option>
                    <option value="دينار">دينار</option>
                    <option value="دولار">دولار</option>
                  </select>
                </div>
              </div>
                <div class="col-md-6">
                  <label class="form-label">القسم</label>
                  <select id="department" class="form-select">
                    <option value="">اختر...</option>
                    <option value="أدب">أدب</option>
                    <option value="تاريخ">تاريخ</option>
                    <option value="علوم">علوم</option>
                    <option value="فلسفة">فلسفة</option>
                    <option value="دين">دين</option>
                    <option value="سياسة">سياسة</option>
                    <option value="اقتصاد">اقتصاد</option>
                    <option value="جغرافيا">جغرافيا</option>
                    <option value="أطفال">أطفال</option>
                    <option value="مراجع">مراجع</option>
                  </select>
                  <button
                    class="btn btn-outline-secondary mt-1"
                    type="button"
                    onclick="addOption('department')"
                  >
                    +
                  </button>
                </div>
                <div class="col-12">
                  <label class="form-label">ملاحظات</label>
                  <textarea class="form-control" id="notes" rows="3"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 5: Review & Confirm -->
        <div class="wizard-step" id="step5" style="display: none"> 
            <div class="card shadow-medium"> <div class="card-header">
                 <h5 class="mb-0">✅ الخطوة 5: مراجعة البيانات والتأكيد</h5>
                 </div>
                  <div class="card-body">
                     <div id="summaryContent">
                         <h6>مراجعة البيانات المدخلة:</h6> 
                         <div class="alert alert-info"> يرجى مراجعة جميع البيانات قبل الحفظ النهائي 

                         </div> 
                         <div id="dataReview"></div> <!-- أزرار النسخة والجزء --> 
                         <div class="mt-3 d-flex flex-wrap gap-2"> 
                            <button class="btn btn-outline-primary" type="button" onclick="duplicateBook('نسخة')" > إضافة نسخة </button> 
                            <button class="btn btn-outline-primary" type="button" onclick="duplicateBook('جزء')" > إضافة جزء </button>
                         </div> <!-- 👇 قسم الباركود المضاف --> 
                         <div class="mt-4 p-3 border rounded bg-light"> 
                            <h6 class="text-primary mb-3">🖨️ توليد باركود</h6> 
                            <input id="barcodeValue" type="text" class="form-control mb-3" placeholder="مثال: 123456789" value="123456789" /> 
                            <div class="d-flex flex-wrap gap-2"> 
                                <button id="generate" class="btn btn-primary flex-fill"> عرض الباركود </button>
                                 <button id="download" class="btn btn-success flex-fill"> تحميل PNG </button> 
                                </div> 
                                <div id="barcodeArea" class="mt-3 text-center p-2 bg-white rounded">
                                     <svg id="barcode"></svg>
                                      <p id="note" class="text-muted small mt-2"></p>
                                     </div> </div> <!-- نهاية قسم الباركود -->
                                     </div> 
                                    </div>
                                 </div> 
                                </div>


        <!-- Navigation Buttons -->
        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-secondary"
            id="prevBtn"
            onclick="changeStep(-1)"
            style="display: none"
          >
            السابق
          </button>
          <div class="ms-auto">
            <button
              type="button"
              class="btn btn-primary gradient-primary shadow-medium fw-bold px-4"
              id="nextBtn"
              onclick="changeStep(1)"
            >
              التالي
            </button>
            <button
              type="submit"
              class="btn btn-success gradient-success shadow-medium fw-bold px-4"
              id="submitBtn"
              style="display: none"
            >
              حفظ الكتاب
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    // تفعيل اللون فقط للصفحة الحالية
    const currentPage = window.location.pathname.split("/").pop();
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

    navLinks.forEach(link => {
        if(link.getAttribute('href') === currentPage){
            link.classList.add('active'); // يظل أبيض غامق فقط للرابط الحالي
        } else {
            link.classList.remove('active');
        }
    });
</script>

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
     <script> 
     const input = document.getElementById("barcodeValue"); 
     const generateBtn = document.getElementById("generate"); 
     const downloadBtn = document.getElementById("download"); const svgElem = document.getElementById("barcode");
      const note = document.getElementById("note"); 
      function gen(value) 
      { if (!value) { note.textContent = "⚠️ أدخل قيمة صحيحة لعرض الباركود."; 
      svgElem.innerHTML = ""; return; } JsBarcode(svgElem, value, 
      { format: "CODE128", lineColor: "#000", width: 2, height: 80, displayValue: true, margin: 8, }); 
      note.textContent = 'اضغط "تحميل PNG" لحفظ الصورة.'; } gen(input.value); generateBtn.addEventListener("click", () => gen(input.value.trim()));
       downloadBtn.addEventListener("click", () => { const svgData = new XMLSerializer().serializeToString(svgElem); const svgBlob = new Blob([svgData],
        { type: "image/svg+xml;charset=utf-8", }); 
        const url = URL.createObjectURL(svgBlob);
         const img = new Image();
          img.onload = () => { const canvas = document.createElement("canvas");
           canvas.width = img.width; canvas.height = img.height; const ctx = canvas.getContext("2d"); 
           ctx.fillStyle = "#ffffff"; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.drawImage(img, 0, 0); 
           URL.revokeObjectURL(url); canvas.toBlob(function (blob) { const a = document.createElement("a");
            a.href = URL.createObjectURL(blob); a.download = (input.value || "barcode") + ".png"; document.body.appendChild(a); a.click(); a.remove(); }
            , "image/png"); }; img.onerror = () => { note.textContent = "❌ خطأ أثناء التحويل. جرّب تجديد الصفحة."; }; img.src = url; }); 
            </script>

    <script>
      let currentStep = 1;
      const totalSteps = 5;
      const stepTitles = [
        "",
        "المعلومات الأساسية",
        "المؤلفون",
        "الناشرون",
        "المزوّد",
        "مراجعة البيانات والتأكيد",
      ];

      function changeStep(direction) {
        if (direction === 1 && !validateCurrentStep()) return;
        document.getElementById(`step${currentStep}`).style.display = "none";
        currentStep += direction;
        document.getElementById(`step${currentStep}`).style.display = "block";
        updateProgressBar();
        updateNavigationButtons();
        document.getElementById("stepTitle").textContent =
          stepTitles[currentStep];
        document.getElementById("currentStepNumber").textContent = currentStep;
        if (currentStep === totalSteps) showDataSummary();
      }

      function updateProgressBar() {
        document.getElementById("progressBar").style.width =
          (currentStep / totalSteps) * 100 + "%";
      }

      function updateNavigationButtons() {
        document.getElementById("prevBtn").style.display =
          currentStep === 1 ? "none" : "block";
        document.getElementById("nextBtn").style.display =
          currentStep === totalSteps ? "none" : "block";
        document.getElementById("submitBtn").style.display =
          currentStep === totalSteps ? "block" : "none";
      }

      function validateCurrentStep() {
        let isValid = true;
        const requiredFields = document
          .getElementById(`step${currentStep}`)
          .querySelectorAll("[required]");
        requiredFields.forEach((f) => {
          if (!f.value.trim()) {
            f.classList.add("is-invalid");
            isValid = false;
          } else {
            f.classList.remove("is-invalid");
          }
        });
        if (!isValid) alert("يرجى تعبئة جميع الحقول المطلوبة قبل المتابعة");
        return isValid;
      }

      function togglePriceField() {
        const val = document.getElementById("supplyMethod").value;
        const priceField = document.getElementById("priceField");
        if (val === "شراء") priceField.style.display = "block";
        else {
          priceField.style.display = "none";
          document.getElementById("price").value = "";
        }
      }

      function showDataSummary() {
        let html = "";
        const bookTitle = document.getElementById("bookTitle").value;
        const classificationCode =
          document.getElementById("classificationCode").value;
        const subTitles = Array.from(document.getElementsByName("subTitles[]"))
          .map((el, i) => {
            const type = document.getElementsByName("subTitleType[]")[i].value;
            return `${el.value} (${type})`;
          })
          .filter((v) => v.trim() !== "");

        const authors = Array.from(document.getElementsByName("authorName[]"))
          .map((el, i) => {
            const role = document.getElementsByName("authorRole[]")[i].value;
            const attr =
              document.getElementsByName("authorAttribute[]")[i].value;
            return `${el.value} - ${role} - ${attr}`;
          })
          .filter((v) => v.trim() !== "");

        const publishers = Array.from(
          document.getElementsByName("publishers[]")
        )
          .map((el, i) => {
            const place =
              document.getElementsByName("publisherPlace[]")[i].value;
            const date = document.getElementsByName("publisherDate[]")[i].value;
            return `${el.value} - ${place} - ${date}`;
          })
          .filter((v) => v.trim() !== "");

        html += `<h6>المعلومات الأساسية:</h6>`;
        html += `<p>العنوان: ${bookTitle}<br>رمز التصنيف: ${classificationCode}<br>العناوين الفرعية: ${subTitles.join(
          ", "
        )}</p>`;
        html += `<h6>المؤلفون:</h6><p>${authors.join("<br>")}</p>`;
        html += `<h6>الناشرون:</h6><p>${publishers.join("<br>")}</p>`;
        html += `<h6>المزوّد:</h6><p>طريقة التزويد: ${
          document.getElementById("supplyMethod").value
        }<br>`;
        html += `السعر: ${document.getElementById("price").value}<br>`;
        html += `القسم: ${document.getElementById("department").value}<br>`;
        html += `ملاحظات: ${document.getElementById("notes").value}</p>`;

        document.getElementById("dataReview").innerHTML = html;
      }

      function duplicateBook(type) {
        const formData = new FormData(document.getElementById("wizardForm"));
        const queryParams = new URLSearchParams();
        formData.forEach((value, key) => queryParams.append(key, value));
        const pageUrl = `add-book.html?duplicate=${type}&${queryParams.toString()}`;
        window.open(pageUrl, "_blank");
      }

      function addOption(selectId) {
        const select = document.getElementById(selectId);
        const newOption = prompt("أدخل الخيار الجديد:");
        if (newOption) {
          const option = document.createElement("option");
          option.value = newOption;
          option.textContent = newOption;
          select.appendChild(option);
        }
      }

      function addSubTitle() {
        const container = document.getElementById("subTitlesContainer");
        const div = document.createElement("div");
        div.className = "input-group mb-2";
        div.innerHTML = `
                <input type="text" class="form-control" name="subTitles[]" placeholder="العنوان الفرعي">
                <select class="form-select" name="subTitleType[]">
                    <option value="">نوع العنوان</option>
                    <option value="رئيسي">رئيسي</option>
                    <option value="فرعي">فرعي</option>
                    <option value="سابق">سابق</option>
                    <option value="بديل">بديل</option>
                    <option value="جامع">جامع</option>
                    <option value="موازي">موازي</option>
                </select>
                <button class="btn btn-outline-danger" type="button" onclick="this.parentNode.remove()">-</button>
            `;
        container.appendChild(div);
      }

      function addAuthor() {
        const container = document.getElementById("authorsContainer");
        const div = document.createElement("div");
        div.className = "input-group mb-2";
        div.innerHTML = `
                <select class="form-select" name="authorRole[]">
                    <option value="">اختر...</option>
                    <option value="رئيسي">رئيسي</option>
                    <option value="مساعد مشارك">مساعد مشارك</option>
                    <option value="مترجم">مترجم</option>
                    <option value="محقق">محقق</option>
                    <option value="مدقق">مدقق</option>
                    <option value="مراجع">مراجع</option>
                    <option value="محرر">محرر</option>
                    <option value="معد">معد</option>
                    <option value="مقدّم">مقدّم</option>
                </select>
                <input type="text" class="form-control" name="authorName[]" placeholder="اسم المؤلف">
                <select class="form-select" name="authorAttribute[]">
                    <option value="">صفة المؤلف</option>
                    <option value="شخص">شخص</option>
                    <option value="ملتقى">ملتقى</option>
                    <option value="هيئة">هيئة</option>
                    <option value="عنوان">عنوان</option>
                </select>
                <button class="btn btn-outline-danger" type="button" onclick="this.parentNode.remove()">-</button>
            `;
        container.appendChild(div);
      }

      function addPublisher() {
        const container = document.getElementById("publishersContainer");
        const div = document.createElement("div");
        div.className = "input-group mb-2";
        div.innerHTML = `
                <input type="text" class="form-control" name="publishers[]" placeholder="اسم الناشر">
                <input type="text" class="form-control" name="publisherPlace[]" placeholder="مكان النشر">
                <input type="date" class="form-control" name="publisherDate[]" placeholder="تاريخ النشر">
                <button class="btn btn-outline-danger" type="button" onclick="this.parentNode.remove()">-</button>
            `;
        container.appendChild(div);
      }

      function handleFormSubmit(e) {
        e.preventDefault();
        alert("تم حفظ بيانات الكتاب بنجاح!");
        return false;
      }

      // Load data if opened for duplication
      window.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        if (params.has("duplicate")) {
          for (const [key, value] of params.entries()) {
            const elements = document.getElementsByName(key);
            elements.forEach((el) => {
              if (el.tagName === "SELECT") el.value = value;
              else el.value = value;
            });
          }
        }
      });


    </script>
  </body>
</html>
