<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© - Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</title>
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø§Ù…Ù„ Ù…Ø¹ ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…Ø©">
    
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Arabic Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Background & Surface Colors */
            --background: hsl(218, 100%, 97%);
            --foreground: hsl(215, 25%, 15%);
            --surface: hsl(0, 0%, 100%);
            --surface-alt: hsl(220, 15%, 96%);

            /* Brand Colors */
            --primary: hsl(215, 90%, 52%);
            --primary-foreground: hsl(0, 0%, 100%);
            --primary-light: hsl(215, 85%, 65%);
            --primary-dark: hsl(215, 95%, 42%);

            /* Secondary Brand */
            --secondary: hsl(195, 85%, 48%);
            --secondary-foreground: hsl(0, 0%, 100%);
            --secondary-light: hsl(195, 80%, 65%);

            /* Accent Colors */
            --accent: hsl(275, 75%, 55%);
            --success: hsl(142, 76%, 45%);
            --warning: hsl(38, 92%, 55%);
            --destructive: hsl(0, 84%, 60%);

            /* Neutral Colors */
            --muted: hsl(220, 15%, 94%);
            --muted-foreground: hsl(215, 16%, 47%);
            --border: hsl(220, 13%, 88%);

            /* Shadows */
            --shadow-soft: 0 2px 8px -2px hsl(215, 25%, 15%, 0.08);
            --shadow-medium: 0 4px 16px -4px hsl(215, 25%, 15%, 0.12);
            --shadow-large: 0 8px 32px -8px hsl(215, 25%, 15%, 0.16);
            --shadow-glow: 0 0 32px hsl(215, 90%, 52%, 0.3);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.6;
        }

        /* Custom utility classes */
        .gradient-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, var(--accent), var(--primary));
        }
        
        .gradient-success {
            background: linear-gradient(135deg, var(--success), hsl(155, 70%, 55%));
        }
        
        .gradient-surface {
            background: linear-gradient(180deg, var(--surface), var(--surface-alt));
        }
        
        .shadow-soft { box-shadow: var(--shadow-soft); }
        .shadow-medium { box-shadow: var(--shadow-medium); }
        .shadow-large { box-shadow: var(--shadow-large); }
        .shadow-glow { box-shadow: var(--shadow-glow); }
        
        .transition-smooth {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Navigation */
        .navbar {
            top: 10px;
            right: 10px;
            left: 10px;
            border-radius: 1rem;
            backdrop-filter: blur(10px);
        }

        .navbar-brand img {
            border-radius: 50%;
        }

        /* Container */
        .container {
            padding-top: 100px;
        }

        /* Cards */
        .stats-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 1rem;
            box-shadow: var(--shadow-medium);
            transition: var(--transition-smooth);
        }

        .stats-card:hover {
            box-shadow: var(--shadow-large);
            transform: translateY(-2px);
        }

        .filter-card {
            background-color: var(--surface);
            border-right: 4px solid var(--primary);
            box-shadow: var(--shadow-soft);
            border-radius: 1rem;
            transition: var(--transition-smooth);
        }

        .filter-card:hover {
            box-shadow: var(--shadow-medium);
        }

        /* Table Styling */
        .table {
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .table-hover tbody tr:hover {
            background-color: var(--muted);
            transition: var(--transition-smooth);
        }

        .highlight-column {
            background-color: rgba(var(--primary-rgb), 0.1) !important;
            color: var(--primary) !important;
            font-weight: 600 !important;
        }

        /* Status badges */
        .status-available {
            background-color: rgba(var(--success-rgb), 0.1);
            color: var(--success);
        }

        .status-borrowed {
            background-color: rgba(var(--warning-rgb), 0.1);
            color: var(--warning);
        }

        .status-discarded {
            background-color: rgba(var(--destructive-rgb), 0.1);
            color: var(--destructive);
        }

        /* Report section */
        .report-header {
            background: var(--gradient-surface);
            border-bottom: 1px solid var(--border);
            border-radius: 1rem 1rem 0 0;
        }

        /* Print styles */
        @media print {
            body * { visibility: hidden !important; }
            #reportSection, #reportSection * { visibility: visible !important; }
            #reportSection { 
                position: absolute; 
                top: 0; 
                left: 0; 
                width: 100%; 
                padding: 20px; 
            }
            .no-print { display: none !important; }
            .navbar, .filter-section, .stats-cards { display: none !important; }
            table { 
                width: 100% !important; 
                border-collapse: collapse !important; 
                margin-top: 20px;
            }
            table th, table td { 
                border: 1px solid #000 !important; 
                padding: 8px !important; 
                font-size: 12px !important;
                text-align: center !important;
            }
            #reportTitle { 
                margin: 20px 0; 
                font-size: 24px; 
                text-align: center; 
                font-weight: bold; 
                page-break-after: avoid;
            }
            #reportHeader { 
                display: flex !important; 
                justify-content: space-between; 
                align-items: center; 
                margin-bottom: 15px; 
                padding: 10px 0;
                border-bottom: 2px solid #000;
            }
        }

        /* Loading animation */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        /* Empty state */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted-foreground);
        }

        .no-data .icon {
            font-size: 4rem;
            opacity: 0.5;
            margin-bottom: 1rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container { padding-top: 120px; }
            .navbar { position: relative; top: 0; margin: 10px; }
            .export-buttons { flex-direction: column; gap: 0.5rem; }
            .table-responsive { font-size: 0.875rem; }
        }
    </style>
</head>

<body>
  <nav
    class="navbar navbar-expand-lg navbar-dark bg-dark py-3 px-4 rounded-3 shadow-lg"
  >
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img
          src="./slogan.png"
          alt="Logo"
          class="rounded-circle me-2"
          width="64px"
          height="64px"
        />
        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØªØ¨ 
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="collapse navbar-collapse justify-content-center"
        id="navbarNavDropdown"
      >
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="add-book.html">ğŸ“š Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="update-books.html">ğŸ“– Ø¹Ø±Ø¶ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØªØ¨</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="advanced-search.html">ğŸ” Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="reports.html"
              >ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="delete-books.html"
              >ğŸ—‘ï¸ Ø­Ø°Ù ÙƒØªØ§Ø¨</a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>

    <div class="container mt-4">
        <!-- Page Header -->
        <div class="mb-5 no-print">
            <h1 class="display-5 fw-bold text-primary mb-2 d-flex align-items-center gap-3">
                ğŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            </h1>
            <p class="text-muted fs-5">Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</p>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-5 stats-cards no-print">
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card stats-card text-center p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØªØ¨</h6>
                            <h2 class="fw-bold" id="totalBooks">1,284</h2>
                        </div>
                        <div style="font-size: 3rem; opacity: 0.8;">ğŸ“š</div>
                    </div>
                    <small class="text-white-50 mt-2 d-block">ğŸ“Š Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</small>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card gradient-secondary text-white text-center p-4 shadow-medium">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50">Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ÙØ¹Ø§Ø±Ø©</h6>
                            <h2 class="fw-bold" id="borrowedBooks">156</h2>
                        </div>
                        <div style="font-size: 3rem; opacity: 0.8;">ğŸ“–</div>
                    </div>
                    <small class="text-white-50 mt-2 d-block">ğŸ“Š Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</small>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card gradient-success text-white text-center p-4 shadow-medium">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50">ÙƒØªØ¨ Ø¬Ø¯ÙŠØ¯Ø©</h6>
                            <h2 class="fw-bold" id="newBooks">42</h2>
                        </div>
                        <div style="font-size: 3rem; opacity: 0.8;">âœ¨</div>
                    </div>
                    <small class="text-white-50 mt-2 d-block">ğŸ“Š Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</small>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="card stats-card text-center p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…ØªØ§Ø­Ø©</h6>
                            <h2 class="fw-bold" id="references">328</h2>
                        </div>
                        <div style="font-size: 3rem; opacity: 0.8;">ğŸ“‹</div>
                    </div>
                    <small class="text-white-50 mt-2 d-block">ğŸ“Š Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</small>
                </div>
            </div>
        </div>

        <!-- Report Filters -->
        <div class="card filter-card p-4 mb-5 filter-section no-print">
            <div class="card-header bg-transparent border-0 pb-2">
                <h5 class="card-title fw-bold d-flex align-items-center gap-2 mb-0">
                    ğŸ¯ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="row g-4 align-items-end">
                    <!-- Report Type Selection -->
                    <div class="col-md-4">
                        <label for="reportType" class="form-label fw-semibold">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                        <select id="reportType" class="form-select form-select-lg">
                            <option value="classificationRange">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØµÙ†ÙŠÙ</option>
                            <option value="entryDateRange">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</option>
                            <option value="supplyMethodPurchase">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ²ÙˆÙŠØ¯ (Ø´Ø±Ø§Ø¡)</option>
                            <option value="supplyMethodGift">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ²ÙˆÙŠØ¯ (Ø¥Ù‡Ø¯Ø§Ø¡)</option>
                            <option value="supplyMethodExchange">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ²ÙˆÙŠØ¯ (ØªØ¨Ø§Ø¯Ù„)</option>
                            <option value="itemTypeReference">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© (Ù…Ø±Ø¬Ø¹)</option>
                            <option value="itemTypeBook">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© (ÙƒØªØ§Ø¨)</option>
                            <option value="borrowed">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ÙØ¹Ø§Ø±Ø©</option>
                            <option value="discarded">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ÙØ®Ø±Ø¬Ø©</option>
                            <option value="category">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</option>
                        </select>
                    </div>
                    
                    <!-- Dynamic Filters -->
                    <div class="col-md-4" id="dynamicFilters">
                        <!-- Classification Range Filters -->
                        <div id="classificationFilters">
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label">Ù…Ù† Ø±Ù‚Ù… ØªØµÙ†ÙŠÙ</label>
                                    <input type="text" class="form-control" id="classificationFrom" placeholder="A100">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Ø¥Ù„Ù‰ Ø±Ù‚Ù… ØªØµÙ†ÙŠÙ</label>
                                    <input type="text" class="form-control" id="classificationTo" placeholder="A999">
                                </div>
                            </div>
                        </div>

                        <!-- Date Range Filters -->
                        <div id="dateFilters" class="d-none">
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" class="form-control" id="dateFrom">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" class="form-control" id="dateTo">
                                </div>
                            </div>
                        </div>

                        <!-- Category Filter -->
                        <div id="categoryFilters" class="d-none">
                            <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</label>
                            <select id="categorySelect" class="form-select">
                                <option value="science">Ø¹Ù„Ù…ÙŠ</option>
                                <option value="history">ØªØ§Ø±ÙŠØ®ÙŠ</option>
                                <option value="literature">Ø£Ø¯Ø¨</option>
                                <option value="economy">Ø§Ù‚ØªØµØ§Ø¯</option>
                                <option value="religious">Ø¯ÙŠÙ†ÙŠ</option>
                                <option value="political">Ø³ÙŠØ§Ø³Ø©</option>
                            </select>
                        </div>

                        <!-- Borrower Filter -->
                        <div id="borrowedFilters" class="d-none">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹ÙŠØ±</label>
                            <input type="text" class="form-control" id="borrowerName" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...">
                            <div class="form-check mt-2">
                                <input type="checkbox" class="form-check-input" id="overdueOnly">
                                <label class="form-check-label" for="overdueOnly">Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ÙÙ‚Ø·</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Generate Button -->
                    <div class="col-md-4">
                        <button id="generateReportBtn" class="btn btn-lg btn-primary gradient-primary w-100 shadow-medium fw-bold">
                            ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
            </div>
            <p class="mt-3 text-muted">Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</p>
        </div>

        <!-- Report Section -->
        <div id="reportSection" style="display: none;">
            <!-- Print Header (hidden on screen) -->
            <div id="reportHeader" class="d-none">
                <div class="d-flex justify-content-between align-items-center mb-4 p-3">
                    <div style="font-size: 4rem;">ğŸ“š</div>
                    <div class="text-center">
                        <h2 class="fw-bold mb-1">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø©</h2>
                        <p class="mb-0">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯</p>
                    </div>
                    <div class="text-start">
                        <small>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: <span id="reportDate"></span></small><br>
                        <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: <span id="totalResults">0</span></small>
                    </div>
                </div>
            </div>

            <!-- Report Controls -->
            <div class="d-flex justify-content-between align-items-center mb-4 no-print">
                <h2 id="reportTitle" class="fw-bold text-primary mb-0">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØªØ¨</h2>
                <div class="export-buttons d-flex gap-2">
                    <button class="btn btn-outline-success btn-sm" onclick="exportToExcel()">
                        ğŸ“Š ØªØµØ¯ÙŠØ± Excel
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="exportToPDF()">
                        ğŸ“„ ØªØµØ¯ÙŠØ± PDF
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="window.print()">
                        ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                </div>
            </div>

            <!-- Report Table -->
            <div class="card shadow-medium">
                <div class="card-header report-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0 fw-semibold">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h5>
                        <span class="badge bg-primary fs-6" id="resultCount">0 Ù†ØªÙŠØ¬Ø©</span>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0" id="reportTable">
                            <thead class="table-dark">
                                <tr id="tableHeader">
                                    <!-- Dynamic headers will be inserted here -->
                                </tr>
                            </thead>
                            <tbody id="reportTableBody">
                                <!-- Dynamic content will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† ÙÙ‚Ø· Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const currentPage = window.location.pathname.split("/").pop();
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

    navLinks.forEach(link => {
        if(link.getAttribute('href') === currentPage){
            link.classList.add('active'); // ÙŠØ¸Ù„ Ø£Ø¨ÙŠØ¶ ØºØ§Ù…Ù‚ ÙÙ‚Ø· Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
        } else {
            link.classList.remove('active');
        }
    });
</script>
    
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <script>
        // Sample Data
        const sampleData = [
            {title:"Ù…Ø¯Ø®Ù„ Ø¥Ù„Ù‰ Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨", authors:"Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠØŒ Ø³Ø§Ø±Ø© Ø­Ø³ÙŠÙ†", serial:"123456", class:"A123", date:"2024-01-01", type:"ÙƒØªØ§Ø¨", method:"Ø´Ø±Ø§Ø¡", category:"science", status:"available", borrower:null, borrowDate:null, returnDate:null},
            {title:"Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©", authors:"ÙØ§Ø·Ù…Ø© ÙŠÙˆØ³Ù", serial:"123457", class:"A124", date:"2024-05-15", type:"Ù…Ø±Ø¬Ø¹", method:"Ø¥Ù‡Ø¯Ø§Ø¡", category:"science", status:"borrowed", borrower:"Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯", borrowDate:"2024-09-01", returnDate:"2024-09-15"},
            {title:"Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©", authors:"Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯", serial:"123458", class:"B200", date:"2023-11-20", type:"ÙƒØªØ§Ø¨", method:"Ø´Ø±Ø§Ø¡", category:"science", status:"borrowed", borrower:"Ù„ÙŠÙ„Ù‰ Ø³Ø§Ù„Ù…", borrowDate:"2024-08-15", returnDate:"2024-08-29"},
            {title:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¶Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", authors:"Ù„ÙŠÙ„Ù‰ Ù†Ø§ØµØ±", serial:"123459", class:"C300", date:"2022-12-10", type:"ÙƒØªØ§Ø¨", method:"ØªØ¨Ø§Ø¯Ù„", category:"history", status:"discarded", borrower:null, borrowDate:null, returnDate:null},
            {title:"Ø§Ù„Ø£Ø¯Ø¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…Ø¹Ø§ØµØ±", authors:"Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ù‚Ø§Ø³Ù…", serial:"123460", class:"D400", date:"2024-03-20", type:"ÙƒØªØ§Ø¨", method:"Ø´Ø±Ø§Ø¡", category:"literature", status:"available", borrower:null, borrowDate:null, returnDate:null},
            {title:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©", authors:"Ù†ÙˆØ± Ø§Ù„Ù‡Ø¯Ù‰ Ù…Ø­Ù…Ø¯", serial:"123461", class:"E150", date:"2024-02-10", type:"Ù…Ø±Ø¬Ø¹", method:"Ø¥Ù‡Ø¯Ø§Ø¡", category:"economy", status:"available", borrower:null, borrowDate:null, returnDate:null},
            {title:"Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©", authors:"Ø®Ø§Ù„Ø¯ Ø£Ø­Ù…Ø¯", serial:"123462", class:"F250", date:"2023-08-15", type:"ÙƒØªØ§Ø¨", method:"Ø´Ø±Ø§Ø¡", category:"science", status:"borrowed", borrower:"Ø£Ù…ÙŠÙ†Ø© Ø¹Ù„ÙŠ", borrowDate:"2024-09-10", returnDate:"2024-09-24"}
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('ar-EG');
            
            // Setup event listeners
            document.getElementById('reportType').addEventListener('change', handleReportTypeChange);
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            
            // Initialize with default view
            handleReportTypeChange();
        });

        // Handle report type change
        function handleReportTypeChange() {
            const reportType = document.getElementById('reportType').value;
            
            // Hide all filter sections
            document.getElementById('classificationFilters').classList.add('d-none');
            document.getElementById('dateFilters').classList.add('d-none');
            document.getElementById('categoryFilters').classList.add('d-none');
            document.getElementById('borrowedFilters').classList.add('d-none');
            
            // Show relevant filter section
            switch(reportType) {
                case 'classificationRange':
                    document.getElementById('classificationFilters').classList.remove('d-none');
                    break;
                case 'entryDateRange':
                    document.getElementById('dateFilters').classList.remove('d-none');
                    break;
                case 'category':
                    document.getElementById('categoryFilters').classList.remove('d-none');
                    break;
                case 'borrowed':
                    document.getElementById('borrowedFilters').classList.remove('d-none');
                    break;
                default:
                    document.getElementById('dateFilters').classList.remove('d-none');
                    break;
            }
        }

        // Generate Report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportTitle = document.getElementById('reportType').selectedOptions[0].text;
            
            // Show loading
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('reportSection').style.display = 'none';
            
            // Simulate loading delay
            setTimeout(() => {
                let filteredData = [...sampleData];
                
                // Apply filters based on report type
                switch(reportType) {
                    case 'classificationRange':
                        const from = document.getElementById('classificationFrom').value.trim().toUpperCase();
                        const to = document.getElementById('classificationTo').value.trim().toUpperCase();
                        if (from && to) {
                            filteredData = filteredData.filter(d => d.class >= from && d.class <= to);
                        }
                        break;
                    case 'entryDateRange':
                        const dateFrom = document.getElementById('dateFrom').value;
                        const dateTo = document.getElementById('dateTo').value;
                        if (dateFrom && dateTo) {
                            filteredData = filteredData.filter(d => d.date >= dateFrom && d.date <= dateTo);
                        }
                        break;
                    case 'category':
                        const category = document.getElementById('categorySelect').value;
                        filteredData = filteredData.filter(d => d.category === category);
                        break;
                    case 'borrowed':
                        const borrowerName = document.getElementById('borrowerName').value.trim().toLowerCase();
                        const overdueOnly = document.getElementById('overdueOnly').checked;
                        filteredData = filteredData.filter(d => d.status === 'borrowed');
                        if (borrowerName) {
                            filteredData = filteredData.filter(d => 
                                d.borrower && d.borrower.toLowerCase().includes(borrowerName)
                            );
                        }
                        if (overdueOnly) {
                            filteredData = filteredData.filter(d => 
                                d.returnDate && new Date(d.returnDate) < new Date()
                            );
                        }
                        break;
                    case 'supplyMethodPurchase':
                        filteredData = filteredData.filter(d => d.method === 'Ø´Ø±Ø§Ø¡');
                        break;
                    case 'supplyMethodGift':
                        filteredData = filteredData.filter(d => d.method === 'Ø¥Ù‡Ø¯Ø§Ø¡');
                        break;
                    case 'supplyMethodExchange':
                        filteredData = filteredData.filter(d => d.method === 'ØªØ¨Ø§Ø¯Ù„');
                        break;
                    case 'itemTypeReference':
                        filteredData = filteredData.filter(d => d.type === 'Ù…Ø±Ø¬Ø¹');
                        break;
                    case 'itemTypeBook':
                        filteredData = filteredData.filter(d => d.type === 'ÙƒØªØ§Ø¨');
                        break;
                    case 'discarded':
                        filteredData = filteredData.filter(d => d.status === 'discarded');
                        break;
                }
                
                // Generate table
                generateTable(filteredData, reportType, reportTitle);
                
                // Hide loading and show results
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('reportSection').style.display = 'block';
            }, 500);
        }

        // Generate Table
        function generateTable(data, reportType, reportTitle) {
            const columns = getTableColumns(reportType);
            
            // Update title and counts
            document.getElementById('reportTitle').textContent = reportTitle;
            document.getElementById('resultCount').textContent = `${data.length} Ù†ØªÙŠØ¬Ø©`;
            document.getElementById('totalResults').textContent = data.length;
            
            // Generate header
            const headerRow = document.getElementById('tableHeader');
            headerRow.innerHTML = '';
            columns.forEach(column => {
                const th = document.createElement('th');
                th.textContent = column.label;
                th.className = `text-center ${column.highlight ? 'highlight-column' : ''}`;
                headerRow.appendChild(th);
            });
            
            // Generate body
            const tbody = document.getElementById('reportTableBody');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = columns.length;
                td.className = 'text-center py-5';
                td.innerHTML = `
                    <div class="no-data">
                        <div class="icon">ğŸ“„</div>
                        <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</h5>
                        <p class="text-muted">ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
                    </div>
                `;
                tr.appendChild(td);
                tbody.appendChild(tr);
            } else {
                data.forEach((item, index) => {
                    const tr = document.createElement('tr');
                    tr.className = 'align-middle';
                    
                    columns.forEach(column => {
                        const td = document.createElement('td');
                        td.className = `text-center ${column.highlight ? 'highlight-column' : ''}`;
                        td.innerHTML = renderCellValue(item, column, index + 1);
                        tr.appendChild(td);
                    });
                    
                    tbody.appendChild(tr);
                });
            }
        }

        // Get table columns based on report type
        function getTableColumns(reportType) {
            const baseColumns = [
                { key: "index", label: "#", highlight: false },
                { key: "title", label: "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨", highlight: false },
                { key: "authors", label: "Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ†", highlight: false }
            ];

            switch(reportType) {
                case 'classificationRange':
                    return [
                        ...baseColumns,
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: true },
                        { key: "serial", label: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ", highlight: false },
                        { key: "type", label: "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©", highlight: false },
                        { key: "status", label: "Ø§Ù„Ø­Ø§Ù„Ø©", highlight: false }
                    ];
                case 'entryDateRange':
                    return [
                        ...baseColumns,
                        { key: "date", label: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„", highlight: true },
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: false },
                        { key: "type", label: "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©", highlight: false },
                        { key: "status", label: "Ø§Ù„Ø­Ø§Ù„Ø©", highlight: false }
                    ];
                case 'supplyMethodPurchase':
                case 'supplyMethodGift':
                case 'supplyMethodExchange':
                    return [
                        ...baseColumns,
                        { key: "method", label: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ²ÙˆÙŠØ¯", highlight: true },
                        { key: "date", label: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„", highlight: false },
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: false },
                        { key: "status", label: "Ø§Ù„Ø­Ø§Ù„Ø©", highlight: false }
                    ];
                case 'itemTypeReference':
                case 'itemTypeBook':
                    return [
                        ...baseColumns,
                        { key: "type", label: "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©", highlight: true },
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: false },
                        { key: "method", label: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ²ÙˆÙŠØ¯", highlight: false },
                        { key: "status", label: "Ø§Ù„Ø­Ø§Ù„Ø©", highlight: false }
                    ];
                case 'category':
                    return [
                        ...baseColumns,
                        { key: "category", label: "Ø§Ù„ÙØ¦Ø©", highlight: true },
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: false },
                        { key: "type", label: "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©", highlight: false },
                        { key: "status", label: "Ø§Ù„Ø­Ø§Ù„Ø©", highlight: false }
                    ];
                case 'borrowed':
                    return [
                        ...baseColumns,
                        { key: "borrower", label: "Ø§Ù„Ù…Ø³ØªØ¹ÙŠØ±", highlight: true },
                        { key: "borrowDate", label: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø©", highlight: true },
                        { key: "returnDate", label: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹", highlight: true },
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: false }
                    ];
                default:
                    return [
                        ...baseColumns,
                        { key: "serial", label: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ", highlight: false },
                        { key: "class", label: "Ø±Ù…Ø² Ø§Ù„ØªØµÙ†ÙŠÙ", highlight: false },
                        { key: "type", label: "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©", highlight: false },
                        { key: "method", label: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ²ÙˆÙŠØ¯", highlight: false },
                        { key: "category", label: "Ø§Ù„ÙØ¦Ø©", highlight: false },
                        { key: "status", label: "Ø§Ù„Ø­Ø§Ù„Ø©", highlight: false }
                    ];
            }
        }

        // Render cell value
        function renderCellValue(item, column, index) {
            switch(column.key) {
                case 'index':
                    return index;
                case 'status':
                    const statusMap = {
                        available: { label: "Ù…ØªØ§Ø­", class: "status-available" },
                        borrowed: { label: "Ù…Ø¹Ø§Ø±", class: "status-borrowed" },
                        discarded: { label: "Ù…Ø®Ø±Ø¬", class: "status-discarded" }
                    };
                    const statusInfo = statusMap[item.status] || { label: item.status, class: "" };
                    return `<span class="badge ${statusInfo.class} px-2 py-1">${statusInfo.label}</span>`;
                case 'category':
                    const categoryMap = {
                        science: "Ø¹Ù„Ù…ÙŠ",
                        history: "ØªØ§Ø±ÙŠØ®ÙŠ", 
                        literature: "Ø£Ø¯Ø¨",
                        economy: "Ø§Ù‚ØªØµØ§Ø¯",
                        religious: "Ø¯ÙŠÙ†ÙŠ",
                        political: "Ø³ÙŠØ§Ø³Ø©"
                    };
                    return categoryMap[item.category] || item.category;
                default:
                    return item[column.key] || '-';
            }
        }

        // Export Functions
        function exportToExcel() {
            const table = document.getElementById('reportTable');
            const wb = XLSX.utils.table_to_book(table, { sheet: "Ø§Ù„ØªÙ‚Ø±ÙŠØ±" });
            const reportTitle = document.getElementById('reportTitle').textContent;
            const fileName = `${reportTitle}_${new Date().toLocaleDateString('ar-EG')}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // Add Arabic font support (basic)
            doc.setFont("helvetica", "bold");
            
            // Add title
            const reportTitle = document.getElementById('reportTitle').textContent;
            doc.text(reportTitle, 105, 15, { align: 'center' });
            
            // Add date
            doc.setFontSize(10);
            doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}`, 15, 25);
            
            // Add table
            doc.autoTable({ 
                html: '#reportTable',
                startY: 35,
                styles: { 
                    fontSize: 8,
                    halign: 'center',
                    cellPadding: 2
                },
                headStyles: {
                    fillColor: [52, 73, 94],
                    textColor: 255,
                    fontStyle: 'bold'
                }
            });
            
            const fileName = `${reportTitle}_${new Date().toLocaleDateString('ar-EG')}.pdf`;
            doc.save(fileName);
        }
    </script>
</body>
</html>