<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Barcode</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Cairo", sans-serif;
        background-color: #f5f6fa;
        padding: 40px 16px;
        display: flex;
        justify-content: center;
      }
      .card {
        width: 100%;
        max-width: 600px;
        background: #fff;
        border-radius: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 24px;
        text-align: center;
      }
      h2 {
        color: #1e90ff;
        margin-bottom: 24px;
      }
      input {
        border-radius: 0.5rem;
        padding: 10px;
        border: 1px solid #ccc;
        font-size: 1rem;
      }
      .controls {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }
      .controls button {
        flex: 1;
        padding: 10px;
        font-size: 1rem;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        color: #fff;
        transition: 0.3s;
      }
      #generate {
        background: linear-gradient(135deg, #1e90ff, #00bfff);
      }
      #generate:hover {
        background: linear-gradient(135deg, #1c86ee, #009acd);
      }
      #download {
        background: linear-gradient(135deg, #28a745, #5cd65c);
      }
      #download:hover {
        background: linear-gradient(135deg, #218838, #45c745);
      }
      #barcodeArea {
        margin-top: 24px;
        text-align: center;
        padding: 16px;
        background: #f0f4f8;
        border-radius: 0.8rem;
      }
      svg {
        width: 100%;
        height: auto;
        max-width: 500px;
        margin: 0 auto;
      }
      #note {
        font-size: 13px;
        color: #666;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>🖨️ توليد باركود من رقم أو نص</h2>

      <input
        id="value"
        type="text"
        placeholder="مثال: 123456789"
        value="123456789"
      />

      <div class="controls">
        <button id="generate">عرض الباركود</button>
        <button id="download">تحميل PNG</button>
      </div>

      <div id="barcodeArea">
        <svg id="barcode"></svg>
        <p id="note"></p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script>
      const input = document.getElementById("value");
      const generateBtn = document.getElementById("generate");
      const downloadBtn = document.getElementById("download");
      const svgElem = document.getElementById("barcode");
      const note = document.getElementById("note");

      function gen(value) {
        if (!value) {
          note.textContent = "⚠️ أدخل قيمة صحيحة لعرض الباركود.";
          svgElem.innerHTML = "";
          return;
        }
        JsBarcode(svgElem, value, {
          format: "CODE128",
          lineColor: "#000",
          width: 2,
          height: 80,
          displayValue: true,
          margin: 8,
        });
        note.textContent = 'اضغط "تحميل PNG" لحفظ الصورة.';
      }

      gen(input.value);

      generateBtn.addEventListener("click", () => gen(input.value.trim()));

      downloadBtn.addEventListener("click", () => {
        const svgData = new XMLSerializer().serializeToString(svgElem);
        const svgBlob = new Blob([svgData], {
          type: "image/svg+xml;charset=utf-8",
        });
        const url = URL.createObjectURL(svgBlob);
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
          URL.revokeObjectURL(url);
          canvas.toBlob(function (blob) {
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = (input.value || "barcode") + ".png";
            document.body.appendChild(a);
            a.click();
            a.remove();
          }, "image/png");
        };
        img.onerror = () => {
          note.textContent = "❌ خطأ أثناء التحويل. جرّب تجديد الصفحة.";
        };
        img.src = url;
      });
    </script>
  </body>
</html>
